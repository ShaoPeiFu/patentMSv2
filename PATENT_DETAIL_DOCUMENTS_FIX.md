# ä¸“åˆ©è¯¦æƒ…é¡µæ–‡æ¡£æ˜¾ç¤ºé—®é¢˜ä¿®å¤

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šï¼š**ç¬¬ä¸€æ¬¡è¿›å…¥è¯¦æƒ…é¡µæ²¡æœ‰ä»»ä½•çš„ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåªæœ‰å½“æˆ‘å¤„äºè¯¦æƒ…é¡µï¼Œåˆ·æ–°é¡µé¢ä¹‹åï¼Œæ‰ä¼šæ˜¾ç¤ºå‡ºæ¥**

## é—®é¢˜åˆ†æ

### 1. æ ¹æœ¬åŸå› 

ä¸“åˆ©åˆ—è¡¨ API (`GET /api/patents`) æ²¡æœ‰åŒ…å« `documents` å­—æ®µï¼Œå¯¼è‡´ï¼š

1. **ç¬¬ä¸€æ¬¡è¿›å…¥è¯¦æƒ…é¡µ**ï¼š

   - ç”¨æˆ·ä»åˆ—è¡¨é¡µç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µ
   - è¯¦æƒ…é¡µé¦–å…ˆå°è¯•ä»æœ¬åœ° store è·å–æ•°æ®ï¼ˆ`patentStore.getPatentById`ï¼‰
   - æœ¬åœ° store çš„æ•°æ®æ¥è‡ªåˆ—è¡¨ APIï¼Œä¸åŒ…å« documents
   - å› æ­¤çœ‹ä¸åˆ°ä»»ä½•æ–‡æ¡£

2. **åˆ·æ–°é¡µé¢å**ï¼š
   - é¡µé¢åˆ·æ–°å¯¼è‡´æœ¬åœ° store æ¸…ç©º
   - è¯¦æƒ…é¡µæ— æ³•ä»æœ¬åœ°è·å–ï¼Œå¼ºåˆ¶è°ƒç”¨ APIï¼ˆ`patentStore.fetchPatentById`ï¼‰
   - è¯¦æƒ… API åŒ…å«å®Œæ•´çš„ documents æ•°æ®
   - å› æ­¤èƒ½çœ‹åˆ°æ‰€æœ‰æ–‡æ¡£

### 2. æ•°æ®æµç¨‹å¯¹æ¯”

#### ä¿®å¤å‰çš„æ•°æ®æµç¨‹

```
åˆ—è¡¨é¡µ â†’ åˆ—è¡¨API (æ— documents) â†’ æœ¬åœ°store â†’ è¯¦æƒ…é¡µ (æ— æ–‡æ¡£)
                                              â†“
                                          é¡µé¢åˆ·æ–°
                                              â†“
                                    è¯¦æƒ…API (æœ‰documents) â†’ è¯¦æƒ…é¡µ (æœ‰æ–‡æ¡£)
```

#### ä¿®å¤åçš„æ•°æ®æµç¨‹

```
åˆ—è¡¨é¡µ â†’ åˆ—è¡¨API (æœ‰documents) â†’ æœ¬åœ°store â†’ è¯¦æƒ…é¡µ (æœ‰æ–‡æ¡£)
```

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®æ”¹ä¸“åˆ©åˆ—è¡¨ API

åœ¨ `server/index.ts` ä¸­ï¼Œä¸ºä¸“åˆ©åˆ—è¡¨ API æ·»åŠ  `documents`ã€`fees` å’Œ `deadlines` çš„ includeï¼š

```typescript
// ä¿®å¤å‰
const [patents, total] = await Promise.all([
  prisma.patent.findMany({
    where,
    include: {
      user: {
        select: { id: true, realName: true, username: true },
      },
      category: {
        select: { id: true, name: true, description: true },
      },
    },
    skip,
    take: parseInt(limit as string),
    orderBy: { createdAt: "desc" },
  }),
  prisma.patent.count({ where }),
]);

// ä¿®å¤å
const [patents, total] = await Promise.all([
  prisma.patent.findMany({
    where,
    include: {
      user: {
        select: { id: true, realName: true, username: true },
      },
      category: {
        select: { id: true, name: true, description: true },
      },
      documents: true, // æ·»åŠ æ–‡æ¡£ä¿¡æ¯
      fees: true, // æ·»åŠ è´¹ç”¨ä¿¡æ¯
      deadlines: true, // æ·»åŠ æˆªæ­¢æ—¥æœŸä¿¡æ¯
    },
    skip,
    take: parseInt(limit as string),
    orderBy: { createdAt: "desc" },
  }),
  prisma.patent.count({ where }),
]);
```

## éªŒè¯ç»“æœ

### 1. API æ•°æ®ä¸€è‡´æ€§æµ‹è¯•

```
âœ… ä¸“åˆ©åˆ—è¡¨è·å–æˆåŠŸ
   - ä¸“åˆ©æ€»æ•°: 5

ğŸ“„ ä¸“åˆ© 1: æµ‹è¯•
   - ID: 15
   - ä¸“åˆ©å·: 1
   âœ… åŒ…å«documentså­—æ®µ
   - æ–‡æ¡£æ•°é‡: 0
   âœ… åŒ…å«feeså­—æ®µ (æ•°é‡: 1)
   âœ… åŒ…å«deadlineså­—æ®µ (æ•°é‡: 1)

ğŸ“Š æ•°æ®å¯¹æ¯” (ä¸“åˆ©ID: 15):
   åˆ—è¡¨API:
   - documents: 0 ä¸ª
   - fees: 1 ä¸ª
   - deadlines: 1 ä¸ª
   è¯¦æƒ…API:
   - documents: 0 ä¸ª
   - fees: 1 ä¸ª
   - deadlines: 1 ä¸ª

âœ… åˆ—è¡¨APIå’Œè¯¦æƒ…APIæ•°æ®ä¸€è‡´ï¼
```

### 2. æ–‡æ¡£æ˜¾ç¤ºæµ‹è¯•

```
3ï¸âƒ£ æ·»åŠ æµ‹è¯•æ–‡æ¡£...
âœ… æ–‡æ¡£æ·»åŠ æˆåŠŸ: { id: 12, name: 'æµ‹è¯•æ–‡æ¡£-åˆ—è¡¨æ˜¾ç¤º' }

4ï¸âƒ£ é‡æ–°è·å–ä¸“åˆ©åˆ—è¡¨ï¼ŒéªŒè¯æ–‡æ¡£æ˜¾ç¤º...
âœ… åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°æ›´æ–°åçš„ä¸“åˆ©
   - æ–‡æ¡£æ•°é‡: 1
   - æ–‡æ¡£åˆ—è¡¨:
     1. æµ‹è¯•æ–‡æ¡£-åˆ—è¡¨æ˜¾ç¤º
        - ç±»å‹: application
        - URL: blob:http://localhost:5173/test-list-display
        - å¤§å°: 5120 bytes

âœ… æˆåŠŸåœ¨åˆ—è¡¨APIä¸­æ‰¾åˆ°æ–°æ·»åŠ çš„æ–‡æ¡£ï¼
```

## å½±å“åˆ†æ

### 1. æ€§èƒ½å½±å“

- **æ•°æ®é‡å¢åŠ **: åˆ—è¡¨ API è¿”å›çš„æ•°æ®é‡å¢åŠ ï¼ˆåŒ…å« documentsã€feesã€deadlinesï¼‰
- **å½±å“ç¨‹åº¦**: è¾ƒå°ï¼Œå› ä¸ºè¿™äº›å…³è”æ•°æ®é€šå¸¸ä¸å¤š
- **ä¼˜åŒ–å»ºè®®**: å¦‚æœæœªæ¥æ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘ï¼š
  - åªè¿”å›æ–‡æ¡£æ•°é‡è€Œä¸æ˜¯å®Œæ•´æ–‡æ¡£åˆ—è¡¨
  - å®ç°åˆ†é¡µæˆ–æ‡’åŠ è½½
  - ä½¿ç”¨ GraphQL æŒ‰éœ€æŸ¥è¯¢

### 2. ç”¨æˆ·ä½“éªŒæå‡

- âœ… ç¬¬ä¸€æ¬¡è¿›å…¥è¯¦æƒ…é¡µå°±èƒ½çœ‹åˆ°æ–‡æ¡£
- âœ… ä¸éœ€è¦åˆ·æ–°é¡µé¢
- âœ… æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯
- âœ… å‡å°‘äº†ä¸å¿…è¦çš„ API è°ƒç”¨

### 3. ä»£ç ä¸€è‡´æ€§

- âœ… åˆ—è¡¨ API å’Œè¯¦æƒ… API è¿”å›ç›¸åŒçš„æ•°æ®ç»“æ„
- âœ… å‰ç«¯ä»£ç ä¸éœ€è¦ä¿®æ”¹
- âœ… æœ¬åœ° store æ•°æ®æ›´å®Œæ•´

## æœ€ä½³å®è·µå»ºè®®

### 1. API è®¾è®¡åŸåˆ™

- **ä¸€è‡´æ€§**: ç›¸å…³ API åº”è¿”å›ä¸€è‡´çš„æ•°æ®ç»“æ„
- **å®Œæ•´æ€§**: åˆ—è¡¨ API åº”åŒ…å«å¸¸ç”¨çš„å…³è”æ•°æ®
- **å¯é€‰æ€§**: å¯ä»¥é€šè¿‡æŸ¥è¯¢å‚æ•°æ§åˆ¶æ˜¯å¦åŒ…å«å…³è”æ•°æ®

### 2. å‰ç«¯ä¼˜åŒ–

```typescript
// å¯ä»¥æ·»åŠ ä¸€ä¸ªå‚æ•°æ§åˆ¶æ˜¯å¦åŒ…å«å…³è”æ•°æ®
const fetchPatents = async (includeRelations = true) => {
  const response = await patentAPI.getPatents({
    page: 1,
    limit: 1000,
    includeRelations, // æ–°å¢å‚æ•°
  });
  // ...
};
```

### 3. åç«¯ä¼˜åŒ–

```typescript
// å¯ä»¥æ ¹æ®æŸ¥è¯¢å‚æ•°å†³å®šæ˜¯å¦åŒ…å«å…³è”æ•°æ®
app.get("/api/patents", async (req, res) => {
  const { includeRelations = "true" } = req.query;

  const include = {
    user: { select: { id: true, realName: true, username: true } },
    category: { select: { id: true, name: true, description: true } },
  };

  if (includeRelations === "true") {
    include.documents = true;
    include.fees = true;
    include.deadlines = true;
  }

  // ...
});
```

## æ€»ç»“

**é—®é¢˜**: ç¬¬ä¸€æ¬¡è¿›å…¥è¯¦æƒ…é¡µçœ‹ä¸åˆ°æ–‡æ¡£ âœ… å·²è§£å†³

**æ ¹æœ¬åŸå› **: ä¸“åˆ©åˆ—è¡¨ API æ²¡æœ‰åŒ…å« documents å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**: ä¸ºåˆ—è¡¨ API æ·»åŠ  documentsã€feesã€deadlines çš„ include

**éªŒè¯ç»“æœ**:

- âœ… åˆ—è¡¨ API ç°åœ¨åŒ…å«å®Œæ•´çš„å…³è”æ•°æ®
- âœ… ç¬¬ä¸€æ¬¡è¿›å…¥è¯¦æƒ…é¡µå¯ä»¥çœ‹åˆ°æ–‡æ¡£
- âœ… ä¸éœ€è¦åˆ·æ–°é¡µé¢
- âœ… æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯

**ç”¨æˆ·ä½“éªŒ**: æ˜¾è‘—æå‡ï¼Œæ“ä½œæ›´æµç•…ï¼Œæ•°æ®æ›´ä¸€è‡´
